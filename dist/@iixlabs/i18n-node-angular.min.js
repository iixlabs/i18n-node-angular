/*! @iixlabs/i18n-node-angular 2015-07-08 12:02:38 */
!function(){var i18nModule=angular.module("i18n",[]);i18nModule.provider("i18n",function(){var SYNC="sync",ASYNC="async",i18nProvider=this;i18nProvider.objectNotation=".",i18nProvider.setObjectNotation=function(delimiter){i18nProvider.objectNotation=delimiter},i18nProvider.translations={},i18nProvider.setTranslations=function(translations){i18nProvider.translations=translations},i18nProvider.mode=SYNC,i18nProvider.useAsyncMode=function(){i18nProvider.mode=ASYNC},i18nProvider.$get=["$rootScope","$http","$q",function($rootScope,$http,$q){var i18nService=function(){function InitiatorFactory(){}var asyncInitiator=function(locale){if(locale!=this.userLanguage){this._localeLoadedDeferred&&this._deferredStack.push(this._localeLoadedDeferred),this._localeLoadedDeferred=$q.defer(),this.loaded=!1,this.userLanguage=locale;var service=this;$http({method:"get",url:"/i18n/"+locale,cache:!0}).success(function(translations){for($rootScope.i18n=translations,service.loaded=!0,service._localeLoadedDeferred.resolve($rootScope.i18n);service._deferredStack.length;)service._deferredStack.pop().resolve($rootScope.i18n);$rootScope.$broadcast("LOCALE_UPDATED")}).error(function(error){for(service._localeLoadedDeferred.reject(error);service._deferredStack.length;)service._deferredStack.pop().reject(error)})}return this._localeLoadedDeferred.promise},syncInitiator=function(){return $rootScope.i18n=i18nProvider.translations,this.loaded=!0,this._localeLoadedDeferred.resolve($rootScope.i18n)};InitiatorFactory.prototype.make=function(mode){return mode==ASYNC?asyncInitiator:syncInitiator},this._localeLoadedDeferred=$q.defer(),this._deferredStack=[],this.loaded=!1;var initFactory=new InitiatorFactory;this.init=initFactory.make(i18nProvider.mode),this.i18n=function(){var serviceDeferred=$q.defer(),service=this;return this.ensureLocaleIsLoaded().then(function(){serviceDeferred.resolve(service)}),serviceDeferred.promise},this.ensureLocaleIsLoaded=function(){return this._localeLoadedDeferred.promise},this.getTranslationObject=function(literal){var result=literal.split(i18nProvider.objectNotation).reduce(function(object,index){return object&&object.hasOwnProperty(index)?object[index]:null},$rootScope.i18n);return result},this.__=function(name){if(!$rootScope.i18n)return name;var translation=$rootScope.i18n[name]||this.getTranslationObject(name);return translation||(translation=name,$rootScope.i18n[name]=translation,i18nProvider.mode==ASYNC&&$http.get("/i18n/"+this.userLanguage+"/"+encodeURIComponent(name)).success(function(translated){$rootScope.i18n[name]=translated})),arguments.length>1&&"function"==typeof vsprintf&&(translation=vsprintf(translation,Array.prototype.slice.call(arguments,1))),translation},this.__n=function(count,singular,plural){if(!$rootScope.i18n)return singular;var translation=$rootScope.i18n[singular]||this.getTranslationObject(singular);if(!translation&&(plural||(plural=singular),translation={one:singular,other:plural},$rootScope.i18n[singular]=translation,i18nProvider.mode==ASYNC)){var requestUri="/i18n/"+this.userLanguage+"/"+encodeURIComponent(singular)+"?plural="+encodeURIComponent(plural)+"&count="+encodeURIComponent(count);$http.get(requestUri).success(function(translated){$rootScope.i18n[singular]=translated})}return translation=1==count?translation.one:translation.other,"function"==typeof vsprintf&&(translation=vsprintf(translation,[count])),translation}};return new i18nService}]}),i18nModule.directive("i18n",["i18n","$rootScope",function(i18n,$rootScope){return{restrict:"A",link:function(scope,element,attributes){function updateText(literal,count){literal=literal||attributes.i18n,count=count||getCount(),void 0===count?element.text(i18n.__(literal)):element.text(i18n.__n(count,literal))}function getCount(){var countAttribute=attributes.count;return countAttribute&&parseInt(countAttribute)}attributes.$observe("i18n",function(value){updateText(value)}),$rootScope.$on("LOCALE_UPDATED",function(){updateText()})}}}]),i18nModule.directive("i18nLocale",["i18n","$rootScope",function(i18n,$rootScope){return{restrict:"A",link:function(scope,element,attributes){attributes.$observe("i18nLocale",function(value){i18n.init(value)}),$rootScope.$watch("i18nLocale",function(newLocale,oldLocale){newLocale&&newLocale!=oldLocale&&i18n.init(newLocale)})}}}]),i18nModule.filter("i18n",["i18n",function(i18n){function isNumber(n){return!isNaN(parseFloat(n))&&isFinite(n)}var filter=function(input){return isNumber(input)?i18n.__n.apply(i18n,arguments):i18n.__.apply(i18n,arguments)};return filter.$stateful=!0,filter}])}();